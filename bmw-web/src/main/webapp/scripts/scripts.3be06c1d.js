"use strict";angular.module("clientTestApp",["ngRoute","ui.calendar","ui.bootstrap"]).config(["$routeProvider","$httpProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/bookingCalendar",{templateUrl:"views/bookingcalendar.html",controller:"BookingcalendarCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/myBookings",{templateUrl:"views/mybookings.html",controller:"MybookingsCtrl"}).otherwise({redirectTo:"/"}),b.defaults.useXDomain=!0}]),angular.module("clientTestApp").controller("MainCtrl",["$scope",function(){}]),angular.module("clientTestApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("clientTestApp").controller("BookingcalendarCtrl",["$scope","$http","AuthService","Booking","Informer",function(a,b,c,d,e){a.allInfos=e.allInfos,a.removeInfos=e.remove,a.agendaDay="Day",a.agendaWeek="Week",a.agendaMonth="Month",a.$watch(c.isLoggedIn,function(b){a.isLoggedIn=b,a.user=c.currentUser()}),a.events=[],a.eventsF=function(c,d,e){a.events.length=0,b.get("http://localhost:8080/book-my-wings/rest/bookings?start=0&pageSize=1000").success(function(b){angular.forEach(b,function(b){var c={id:b.bookingId,title:b.aircraft.registration+" "+b.pilot.firstName,start:new Date(b.start),end:new Date(b.end),allDay:!1};a.events.push(c)})}).error(function(){}),e(a.events)},a.alertOnEventClick=function(b){a.startTime=b.start,a.endTime=b.end},a.alertOnDrop=function(b,c){a.alertMessage="Event Droped to make dayDelta "+c},a.alertOnResize=function(b,c,d){a.alertMessage="Event Resized to make dayDelta "+d},a.dayClick=function(b){a.currentDate=b,a.alertMessage="Please choose booking-time for "+$.datepicker.formatDate("dd.mm.yy",b)},a.addRemoveEventSource=function(a,b){var c=0;angular.forEach(a,function(d,e){a[e]===b&&(a.splice(e,1),c=1)}),0===c&&a.push(b)},a.addEvent=function(){var b=new Date;b.setTime(a.currentDate.getTime()),b.setHours(a.startTime.getHours(),a.startTime.getMinutes(),0,0);var e=new Date;e.setTime(a.currentDate.getTime()),e.setHours(a.endTime.getHours(),a.endTime.getMinutes(),0,0);var f={aircraft:a.aircraft,pilot:c.currentUser(),start:b,end:e};d.addBooking(f)},a.remove=function(b){a.events.splice(b,1)},a.changeView=function(a,b){b.fullCalendar("changeView",a)},a.renderCalender=function(a){a&&a.fullCalendar("render")},a.uiConfig={calendar:{height:450,editable:!0,header:{left:"title",center:"",right:"today prev,next"},eventClick:a.alertOnEventClick,eventDrop:a.alertOnDrop,eventResize:a.alertOnResize,dayClick:a.dayClick,defaultView:"agendaWeek"}},a.uiConfig.calendar.dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],a.uiConfig.calendar.dayNamesShort=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],a.agendaDay="Day",a.agendaWeek="Week",a.agendaMonth="Month",a.eventSources=[a.events,a.eventSource,a.eventsF],a.startTime=new Date,a.startTime.setHours("8","00","0","0"),a.endTime=new Date,a.endTime.setHours("18","00","0","0"),a.hstep=1,a.mstep=30,a.ismeridian=!1,a.title="Please choose aircraft",a.status={isopen:!1},a.toggled=function(b){a.title=b.registration,a.aircraft=b,a.status.isopen=!a.status.isopen},b.get("http://localhost:8080/book-my-wings/rest/aircrafts/business/pilot/"+c.currentUser().id).success(function(b){a.aircrafts=b}).error(function(){})}]),angular.module("clientTestApp").factory("Base64",function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(b){var c,d,e,f,g,h="",i="",j="",k=0;do c=b.charCodeAt(k++),d=b.charCodeAt(k++),i=b.charCodeAt(k++),e=c>>2,f=(3&c)<<4|d>>4,g=(15&d)<<2|i>>6,j=63&i,isNaN(d)?g=j=64:isNaN(i)&&(j=64),h=h+a.charAt(e)+a.charAt(f)+a.charAt(g)+a.charAt(j),c=d=i="",e=f=g=j="";while(k<b.length);return h},decode:function(b){var c,d,e,f,g,h="",i="",j="",k=0,l=/[^A-Za-z0-9\+\/\=]/g;l.exec(b)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do e=a.indexOf(b.charAt(k++)),f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),j=a.indexOf(b.charAt(k++)),c=e<<2|f>>4,d=(15&f)<<4|g>>2,i=(3&g)<<6|j,h+=String.fromCharCode(c),64!=g&&(h+=String.fromCharCode(d)),64!=j&&(h+=String.fromCharCode(i)),c=d=i="",e=f=g=j="";while(k<b.length);return h}}}),angular.module("clientTestApp").controller("AuthenticationCtrl",["$scope","$http",function(){}]),angular.module("clientTestApp").factory("AuthService",["$http","$location",function(a,b){var c,d={id:"dummy",pilotRole:{pilotRole:"dummy"}};return{login:function(b){a.get("http://localhost:8080/book-my-wings/rest/pilots/"+b).success(function(a){c=a}).error(function(){})},isLoggedIn:function(){return"dummy"!=c.id},currentUser:function(){return c?c:d},isAdmin:function(){return"admin"===c.pilotRole.pilotRole},logout:function(){a.defaults.headers.common.authorization="",c=d,b.url("/")}}}]).factory("LoginRedirectInterceptor",["$q","$window","$location",function(a,b,c){return function(b){var d=function(a){return a},e=function(b){if(401===b.status||403===b.status){var d=c.path();c.url("/login"+(d?"?redir="+d:""))}return a.reject(b)};return b.then(d,e)}}]),angular.module("clientTestApp").controller("LoginCtrl",["$scope","$http","$location","Base64","AuthService",function(a,b,c,d,e){a.login=function(a){b.defaults.headers.common.authorization="Basic "+d.encode(a.name+":"+a.pass),e.login(a.name,a.pass);var f=c.search().redir;c.url(f?f:"/")}}]),angular.module("clientTestApp").directive("a",function(){return{restrict:"E",link:function(a,b,c){(c.ngClick||""===c.href||"#"===c.href)&&b.on("click",function(a){a.preventDefault()})}}}),angular.module("clientTestApp").controller("HeaderCtrl",["$scope","$location","AuthService",function(a,b,c){a.$watch(c.isLoggedIn,function(b){a.isLoggedIn=b,a.user=c.currentUser(),a.isAdmin=c.isAdmin()}),a.active=function(a){return a===b.path()},a.logout=function(){c.logout()}}]),angular.module("clientTestApp").factory("Booking",["$http","AuthService","Informer",function(a,b,c){return{addBooking:function(b){a.post("http://localhost:8080/book-my-wings/rest/bookings/booking",b).success(function(){c.inform("Successfully added booking","info")}).error(function(a,b){c.inform("Error while adding booking: "+a+b,"info")})},getBookingsForPilot:function(){return a.get("http://localhost:8080/book-my-wings/rest/bookings?start=0&pageSize=100").success(function(a){var b=[];return $.each(a,function(a,c){var d={id:c.bookingId,title:c.aircraft.registration+" "+c.pilot.firstName,start:new Date(c.start),end:new Date(c.end),allDay:!1};b.push(d)}),b}).error(function(){})}}}]),angular.module("clientTestApp").factory("Informer",function(){var a=[],b={};return b.inform=function(b,c){a.push({msg:b,type:c})},b.allInfos=function(){return a},b.remove=function(b){a.splice(a.indexOf(b),1)},b}),angular.module("clientTestApp").controller("MybookingsCtrl",["$scope","$http","AuthService","Informer",function(a,b,c,d){a.events=[],b.get("http://localhost:8080/book-my-wings/rest/bookings/filter/pilot/"+c.currentUser().id).success(function(c){angular.forEach(c,function(c){b.get("http://localhost:8080/book-my-wings/rest/bookings/booking/transitions/"+c.bookingId).success(function(a){c.transitions=a}),a.events.push(c)})}).error(function(a,b){d.inform("Error reading your bookings: "+a+b,"error")})}]);